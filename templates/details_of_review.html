<!DOCTYPE html>
<html>

<head>
    <style>
        a {
            color: black;
            text-decoration: none;
        }

        .stars {
            color: rgb(163, 223, 249);
            font-size: 150%;
            padding-left: 15%;
        }

        .review {
            width: 700px;

            margin: auto;
            margin-top: 7%;
        }

        #product-image {
            width: 30%;

            /* border: 1px solid rgb(163, 223, 249); */
            margin-left: 5%;
            padding: 1%;
        }

        #product-name {
            font-size: 110%;
            margin-top: 3%;
            margin-bottom: 1%;
            margin-left: 5%;
        }

        #review-contents {
            width: 80%;

            background-color: rgb(226, 226, 226);
            border-radius: 10px;
            color: rgb(91, 91, 91);
            margin: auto;
            margin-top: 1%;
            padding: 2% 5%;
        }

        #stars-variable {
            display: none;
        }

        #user-id {
            margin: 1%;
        }

        #good,
        #bad {
            float: left;
            width: 10%;

            background-color: rgb(226, 226, 226);
            border: none;
            border-radius: 5px;
            color: rgb(91, 91, 91);
            font-size: 90%;
            margin: 1%;
            padding: 1% 0%;
        }

        #bad:hover,
        #good:hover {
            background-color: rgb(198, 198, 198);
        }

        .square {
            width: 63px;
            height: 63px;
            overflow: hidden;
            border-radius: 50%;
            margin: 0% 5%;
            float: left;
            position: relative;
        }

        .image-cropper {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: relative;
        }

        .image-cropper img {
            width: auto;
            height: auto;
            max-width: none;
            max-height: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #product-image-check {
            display: none;
        }
    </style>
</head>

<body>
    {% extends "index.html" %}

    {% block section %}
    <div class="review">
        <a href="/user_reviews/{{data.buyerId}}/">
            <div class="square">
                <div class="image-cropper">
                    <img src="/static/images/profiles/{{profile_image_path}}" id="profile">
                </div>
            </div>
        </a>
        <div id="user-id"><a href="/user_reviews/{{data.buyerId}}/">{{data.buyerId}}<a></div>
        <div id="review-title">{{data.reviewTitle}}</div>
        <div class="stars">
            <div id="stars-variable">{{data.starsVariable}}</div>
            <span class="star" id="0">‚òÖ</span>
            <span class="star" id="1">‚òÖ</span>
            <span class="star" id="2">‚òÖ</span>
            <span class="star" id="3">‚òÖ</span>
            <span class="star" id="4">‚òÖ</span>
        </div>
        <hr>
        <img src="/static/images/reviews/{{data.img_path}}" id="product-image">
        <div id="product-image-check">{{data.img_path}}</div>
        <br>
        <div id="review-contents">{{data.reviewContents}}</div>
        <br>
        <hr>
        <button name="good" id="good">üëç {{good}}</button>
        <button name="bad" id="bad">üëé {{bad}}</button>
    </div>

    <script>
        function starFill() {
            star = parseInt(document.getElementById("stars-variable").innerHTML);
            stars = document.getElementsByClassName("star");
            for (i = 0; i < stars.length; i++) {
                if (i > star) {
                    stars.item(i).innerHTML = "‚òÜ";
                } else {
                    stars.item(i).innerHTML = "‚òÖ";
                }
            }
        }
        starFill();

        // -1ÏùÄ bad, 0ÏùÄ none, 1ÏùÄ good
        function showHeart() {
            $.ajax({
                type: 'GET',
                url: '/show_review_heart/{{sellerId}}/{{key}}/',
                data: {},
                success: function (response) {
                    let heart = response['heart'];
                    if (heart['heart'] == "1") {
                        $("#good").css("background-color", "rgb(163, 223, 249, 0.75)");
                        $("#good").css("color", "rgb(61, 140, 174)");
                        $("#good").mouseenter(function () {
                            $(this).css("background-color", "rgb(166, 208, 225)");
                        }).mouseleave(function () {
                            $(this).css("background-color", "rgb(163, 223, 249, 0.75)")
                        });
                        $("#good").attr("onclick", "cancel()");
                        $("#bad").attr("onclick", "bad()");
                    } else if (heart['heart'] == "-1") {
                        $("#bad").css("background-color", "pink");
                        $("#bad").css("color", "rgb(156, 87, 87)");
                        $("#bad").mouseenter(function () {
                            $(this).css("background-color", "rgb(235, 180, 189)");
                        }).mouseleave(function () {
                            $(this).css("background-color", "pink")
                        });
                        $("#good").attr("onclick", "good()");
                        $("#bad").attr("onclick", "cancel()");
                    } else {
                        $("#good").attr("onclick", "good()");
                        $("#bad").attr("onclick", "bad()");
                    }
                }
            });
        }

        function good() {
            $.ajax({
                type: 'POST',
                url: '/update_review_heart/{{sellerId}}/{{key}}/1',
                data: {
                    heart: 1
                },
                success: function (response) {
                    alert(response['msg']);
                    window.location.reload()
                }
            });
        }

        function bad() {
            $.ajax({
                type: 'POST',
                url: '/update_review_heart/{{sellerId}}/{{key}}/-1',
                data: {
                    heart: -1
                },
                success: function (response) {
                    alert(response['msg']);
                    window.location.reload()
                }
            });
        }

        function cancel() {
            $.ajax({
                type: 'POST',
                url: '/update_review_heart/{{sellerId}}/{{key}}/0',
                data: {
                    heart: 0
                },
                success: function (response) {
                    alert(response['msg']);
                    window.location.reload()
                }
            });
        }

        showHeart();

        // Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞ ÎßûÏ∂îÍ∏∞
        window.onload = function () {
            var croppers = document.querySelectorAll('.image-cropper');
            croppers.forEach(function (cropper) {
                var img = cropper.querySelector('img');
                var imgWidth = img.naturalWidth; // Í∏∞Î≥∏ Ïù¥ÎØ∏ÏßÄ Í∞ÄÎ°ú
                var imgHeight = img.naturalHeight; // Í∏∞Î≥∏ Ïù¥ÎØ∏ÏßÄ ÏÑ∏Î°ú
                var cropperWidth = cropper.offsetWidth;
                var cropperHeight = cropper.offsetHeight;

                if (imgWidth / imgHeight > cropperWidth / cropperHeight) { // Í∞ÄÎ°úÍ∞Ä ÏÑ∏Î°úÎ≥¥Îã§ Í∏∏Î©¥
                    img.style.width = 'auto';
                    img.style.height = '100%';
                } else { // ÏÑ∏Î°úÍ∞Ä Í∞ÄÎ°úÎ≥¥Îã§ Í∏∏Î©¥
                    img.style.width = '100%';
                    img.style.height = 'auto';
                }
            });
        };
        
        if (document.getElementById("product-image-check").innerHTML == "") {
            document.getElementById("product-image").style.display = "none";
        }
    </script>
    {% endblock section %}
</body>

</html>