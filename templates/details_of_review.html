<head>
    <link rel="stylesheet" href="/static/details_of_review.css">
</head>

<body>
    {% extends "index.html" %}

    {% block section %}
    <!-- ì „ì²´ div() (wrapper) -->
    <div class="wrapper">
        <!-- ë¦¬ë·° ì‘ì„±ìì˜ ì‚¬ì§„ê³¼ ì•„ì´ë”” ì •ë³´ -->
        <a href="/user_list/{{data.buyerId}}/" id="profile-link">
            <img src="/static/images/profiles/{{profile_image_path}}" id="profile">
        </a>
        <div id="user-id"><a href="/user_list/{{data.buyerId}}/">{{data.buyerId}}<a></div>

        <!-- ë¦¬ë·° ì œëª© -->
        <div id="review-title">{{data.reviewTitle}}</div>
        <!-- ë¦¬ë·° ë³„ì  -->
        <div class="stars">
            <span class="star" id="0">â˜…</span>
            <span class="star" id="1">â˜…</span>
            <span class="star" id="2">â˜…</span>
            <span class="star" id="3">â˜…</span>
            <span class="star" id="4">â˜…</span>
        </div>
        <hr>
        <!-- ë¦¬ë·° ì‚¬ì§„ -->
        <img src="/static/images/reviews/{{data.img_path}}" id="review-image">
        <br>
        <!-- ë¦¬ë·° ë‚´ìš© -->
        <div id="review-contents">{{data.reviewContents}}</div>
        <br>
        <!-- ë¦¬ë·° ë„ì›€ë¼ìš”, ë³„ë¡œì˜ˆìš” ë²„íŠ¼ -->
        <button name="good" id="good">ğŸ‘ {{good}}</button>
        <button name="bad" id="bad">ğŸ‘ {{bad}}</button>
        <!-- ë¦¬ë·° ì‚­ì œ ë²„íŠ¼(ì‘ì„±ìì—ê²Œë§Œ ë³´ì„) -->
        <input type="button" onclick="location.href='/delete_review/{{key}}/{{data.sellerId}}/';" value="ì‚­ì œí•˜ê¸°"
            id="delete">
    </div>

    <script>
        // ë³„ì ë§Œí¼ ë³„ ì±„ìš°ê¸°
        function starFill() {
            star = parseInt("{{data.starsVariable}}");
            stars = document.getElementsByClassName("star");
            for (i = 0; i < stars.length; i++) {
                if (i > star) {
                    stars.item(i).innerHTML = "â˜†";
                } else {
                    stars.item(i).innerHTML = "â˜…";
                }
            }
        }
        starFill();

        // -1ì€ bad(ë³„ë¡œì˜ˆìš”), 0ì€ none, 1ì€ good(ë„ì›€ë¼ìš”)
        function showHeart() {
            $.ajax({
                type: 'GET',
                url: '/show_review_heart/{{sellerId}}/{{key}}/',
                data: {},
                success: function (response) {
                    let heart = response['heart'];
                    if (heart['heart'] == "1") // ê¸°ì¡´ì— ë„ì›€ë¼ìš”ë¥¼ ì´ë¯¸ ëˆŒë €ë‹¤ë©´
                    {
                        // ë²„íŠ¼ ê¸°ë³¸ê³¼ í˜¸ë²„ ìƒ‰ê¹” ì„¤ì •
                        $("#good").css("background-color", "rgb(163, 223, 249, 0.75)");
                        $("#good").css("color", "rgb(61, 140, 174)");
                        $("#good").mouseenter(function () {
                            $(this).css("background-color", "rgb(166, 208, 225)");
                        }).mouseleave(function () {
                            $(this).css("background-color", "rgb(163, 223, 249, 0.75)")
                        });
                        // í´ë¦­ í•¨ìˆ˜ ì„¤ì •
                        $("#good").attr("onclick", "cancel()");
                        $("#bad").attr("onclick", "bad()");
                    }
                    else if (heart['heart'] == "-1") // ê¸°ì¡´ì— ë³„ë¡œì˜ˆìš”ë¥¼ ì´ë¯¸ ëˆŒë €ë‹¤ë©´
                    {
                        // ë²„íŠ¼ ê¸°ë³¸ê³¼ í˜¸ë²„ ìƒ‰ê¹” ì„¤ì •
                        $("#bad").css("background-color", "pink");
                        $("#bad").css("color", "rgb(156, 87, 87)");
                        $("#bad").mouseenter(function () {
                            $(this).css("background-color", "rgb(235, 180, 189)");
                        }).mouseleave(function () {
                            $(this).css("background-color", "pink")
                        });
                        // í´ë¦­ í•¨ìˆ˜ ì„¤ì •
                        $("#good").attr("onclick", "good()");
                        $("#bad").attr("onclick", "cancel()");
                    }
                    else // ê¸°ì¡´ì— ì•„ë¬´ê²ƒë„ ëˆ„ë¥´ì§€ ì•Šì•˜ë‹¤ë©´
                    {
                        // í´ë¦­ í•¨ìˆ˜ ì„¤ì •
                        $("#good").attr("onclick", "good()");
                        $("#bad").attr("onclick", "bad()");
                    }
                }
            });
        }

        // ë„ì›€ë¼ìš” ë²„íŠ¼ ëˆ„ë¥´ë©´ ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜
        function good() {
            $.ajax({
                type: 'POST',
                url: '/update_review_heart/{{sellerId}}/{{key}}/1',
                data: {
                    heart: 1
                },
                success: function (response) {
                    window.location.reload()
                }
            });
        }

        // ë³„ë¡œì˜ˆìš” ë²„íŠ¼ ëˆ„ë¥´ë©´ ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜
        function bad() {
            $.ajax({
                type: 'POST',
                url: '/update_review_heart/{{sellerId}}/{{key}}/-1',
                data: {
                    heart: -1
                },
                success: function (response) {
                    window.location.reload()
                }
            });
        }

        // ì´ë¯¸ ëˆ„ë¥¸ ë²„íŠ¼ ë˜ ëˆ„ë¥´ë©´ ì·¨ì†Œí•˜ëŠ” í•¨ìˆ˜
        function cancel() {
            $.ajax({
                type: 'POST',
                url: '/update_review_heart/{{sellerId}}/{{key}}/0',
                data: {
                    heart: 0
                },
                success: function (response) {
                    window.location.reload()
                }
            });
        }

        // ë¡œê·¸ì¸ì—†ì´ ë²„íŠ¼ ëˆ„ë¥´ë©´ alert í›„ login í™”ë©´ìœ¼ë¡œ ë„˜ì–´ê°€ê¸°
        function alertLogin() {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            location.href = "/login";
        }

        // ë¡œê·¸ì¸ì—†ì´ ë“¤ì–´ê°€ë©´ showHeartëŒ€ì‹  alert ë²„íŠ¼ ì—°ê²°í•˜ê¸°
        if ("{{session['id']}}" != "") {
            showHeart();
        }
        else {
            $("#good").attr("onclick", "alertLogin()");
            $("#bad").attr("onclick", "alertLogin()");
        }

        // ë¦¬ë·° ì´ë¯¸ì§€ê°€ ì—†ë‹¤ë©´ ì´ë¯¸ì§€ë¥¼ display noneìœ¼ë¡œ ë°”ê¾¸ê¸°
        if ("{{data.img_path}}" == "empty.jpeg") {
            document.getElementById("review-image").style.display = "none";
        }

        // ì‘ì„±ì ì•„ì´ë””ì™€ ë¡œê·¸ì¸í•œ ì•„ì´ë””ê°€ ê°™ì§€ ì•Šìœ¼ë©´, ì‚­ì œí•˜ê¸° ë²„íŠ¼ ë³´ì´ì§€ ì•Šê²Œ í•˜ê¸°
        if ("{{session['id']}}" != "{{data.buyerId}}") {
            document.getElementById("delete").style.display = "none";
        }
    </script>
    {% endblock section %}
</body>